#!/bin/bash
apt update -y
apt install unzip -y
sed -i 's/#net.ipv4.ip_forward=1/net.ipv4.ip_forward=1/' /etc/sysctl.conf
echo "net.ipv4.ip_nonlocal_bind = 1" >> /etc/sysctl.conf
sysctl -p 
apt update -y
apt install git -y
apt install curl -y
apt update -y
apt install docker.io -y
cat > daemon.json << EOF
{
    "exec-opts": ["native.cgroupdriver=systemd"]
}
EOF
mv daemon.json /etc/docker/
systemctl daemon-reload
systemctl restart docker
systemctl enable docker
apt-get update
apt install gpg -y
apt-get install -y apt-transport-https
apt-get install -y ca-certificates
sleep 2
mkdir -p /etc/apt/keyrings
echo "deb [signed-by=/etc/apt/keyrings/kubernetes.gpg] https://apt.kubernetes.io/ kubernetes-xenial main" | tee /etc/apt/sources.list.d/kubernetes.list
curl -fsSL https://packages.cloud.google.com/apt/doc/apt-key.gpg | gpg --dearmor -o /etc/apt/keyrings/kubernetes.gpg
apt-get update
K_VER="1.22.17-00"
apt install -y kubectl=${K_VER}
apt-mark hold kubectl
sed -i '/swap/d' /etc/fstab
swapoff -a
mkdir /root/.kube
cat > config << EOF
apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUMvakNDQWVhZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJek1EZ3lNVEEyTkRJd01Gb1hEVE16TURneE9EQTJOREl3TUZvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTHJSCjJYeDlMVW41RGJvcFlUaHEyajREQmcxNzZkSmxTYXhRTHN1TmdVMDh6TklSMklyUlZLakZhKy9hdHdwVlJkcVgKU1pCQnNFRWtSYThOWk4zWkFGWmJYb28weGY0c05KQmU1NXkzM1J1NXRQbFc4MXRWM0J6L0NPRlZxUkk4cmhHRworZmF3MnowY2pIanNrZlJGVTgzU25tYk5uWFptOEhsalZ4NS94VHJ1WUlKL2w4Q2Zyb2I1alhtMXlkQTNiVS9kCmF5ZHhkenZ4YUh6VVFIU0FVRWRUOUlSVDNZRzVuQVowdDBqMWJvQjdhYWlaK20xQzc5RkFETDlyT0VURHdFMEcKZGpoTjNNNHNjZ1BpeE5hbzdTK05XdmZxdUpOWE9QOE9hRGx0TWNUSUhNM0kreDVEeER0dTUzVTdPU3d2eEtMSwpNaDJzYndMeUw5VmJ5UHdYUzJVQ0F3RUFBYU5aTUZjd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZDckpuUnBvKzZQc2dnamZydjNZYjNTNnBjTFFNQlVHQTFVZEVRUU8KTUF5Q0NtdDFZbVZ5Ym1WMFpYTXdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBQXlVcDFQQSs2d2txbSswUXc5Qwp4N0N4YTYvRGNxWlpXeXJSWFRpTHlwQVJKajI2cjh3M2k2MWVDOWJibG00RjlNd0V0MDQ0UW5KZHNPMXBFdFpYCisxZ0Y5UlIwdG1DOHZuNWJ4Rjd1T0xIYUFiTnNsM1JnZ0JvY1Nodi9TVzhmL1V2Qmp5ZE1tbWlUZjRsNCtlYW4KdTd6N3NzaVNUazRPNThuZDFJVTI5S2JCcjRhbmV1ZUROSUtVU1ZCdGlqbHhCT2c5aS9PdTN4NUpucndIdWJRaApCcUpkaXNkUGJDUWxFc1VmYmVyUXplNGhHbHhMM1JRQU5JRmQ1VWdiV0I3ZXR2bFE2eHlyb1RUK1UvQ0lZOHJjCnlwWVpaUmtZT0FBaEhjb1VXd0Fwa0xrWk1TT2tvYlA0SEx0RlBzY2sxNEN0VCtwTTVXVFppaHlMUFZsU3AzSE0KajRBPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
    server: https://138.91.249.176:8443
  name: kubernetes
contexts:
- context:
    cluster: kubernetes
    user: kubernetes-admin
  name: kubernetes-admin@kubernetes
current-context: kubernetes-admin@kubernetes
kind: Config
preferences: {}
users:
- name: kubernetes-admin
  user:
    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURJVENDQWdtZ0F3SUJBZ0lJZWliMUVDU0dqbXd3RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TXpBNE1qRXdOalF5TURCYUZ3MHlOREE0TWpBd05qUXlNRE5hTURReApGekFWQmdOVkJBb1REbk41YzNSbGJUcHRZWE4wWlhKek1Sa3dGd1lEVlFRREV4QnJkV0psY201bGRHVnpMV0ZrCmJXbHVNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQTBKRG1UdE40WlpiY3J5Q0gKYThxSnU5b29hR1R4M2hmaUJoZGZnUnBZS3ptb1ExeTdsL3BzTkhaRHVueURhRkZnVko4MFZJV2ZQQVZSaStwawp5bE53YjArVjZjeGx3TWhmeDdSUkx2Wm1qWDBxV01Cc2dXdG9hUldXSjh2WW1GL29Ra0U0T1EwVjN1MXhVKzFRCnFOaUI1Z2h2RzRTUEtIQ05yQmF0cGkrYmtlUWR0bk5PbThWQTNhN3pWc2lHLy8rQVpnU3pJZktZb3ROSDdLaEMKMHZYcmZzNTBoN1MydXNKRHZCTGJ1RWNtR25qenpmUFFJa2hXazRRRFFvbFV6NWp3VkpTc2JRWkRmaUhOK1luNApkcEFuRVk3MnFJL1J2cEpVV0tXMElHZEFLVlN2N29UckplcWRGNUVzaHZ0U0s3V1J3a0krbmdINXZnR2w4RlU5ClRyNWlKUUlEQVFBQm8xWXdWREFPQmdOVkhROEJBZjhFQkFNQ0JhQXdFd1lEVlIwbEJBd3dDZ1lJS3dZQkJRVUgKQXdJd0RBWURWUjBUQVFIL0JBSXdBREFmQmdOVkhTTUVHREFXZ0JRcXlaMGFhUHVqN0lJSTM2NzkyRzkwdXFYQwowREFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBQVhPdWYzU09ObmQ4dW0wTkJnbE1uYm93SzJmWTZrOWFHdmhBCjNlWks1US9iZ1MxNXdjYis3NVVJMVVOTlE0WnhobzdBcXo0TGkxL3U4WXlBR0RncENTWnNnMDhteU5FZkVTOG8KY0xoR3RuZDR4bmFCMVNzRWdqSmYyVlVsSjdoTjVGdmJJRjNXZ0Vsa1cxTXYrdlhPOXRXNkFPK05hTWtSc0N1NApaNGRLRnZIeVYvcTRpQWIxcjU0dFB4OUF3K3Z4TDFjZmpMUHNQU0pZb1JRTG04cHFBVGpoV0JBK1Mxczdzd3k1CnROZWFnRnU3VFlJZ1FMaGR4YWlYU3FIemRxUzBEdVFxcHpSU1k0SHNDWVE5TWF0YTE5NE56MU04Y3Z5d2tOTmsKRnJmRHZGWjZXOGxsYi9nckEzMld5RVh6KzBQRURQOE5IWlhMNU5TVHBBRE11MU96QXc9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
    client-key-data: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBMEpEbVR0TjRaWmJjcnlDSGE4cUp1OW9vYUdUeDNoZmlCaGRmZ1JwWUt6bW9RMXk3CmwvcHNOSFpEdW55RGFGRmdWSjgwVklXZlBBVlJpK3BreWxOd2IwK1Y2Y3hsd01oZng3UlJMdlptalgwcVdNQnMKZ1d0b2FSV1dKOHZZbUYvb1FrRTRPUTBWM3UxeFUrMVFxTmlCNWdodkc0U1BLSENOckJhdHBpK2JrZVFkdG5OTwptOFZBM2E3elZzaUcvLytBWmdTeklmS1lvdE5IN0toQzB2WHJmczUwaDdTMnVzSkR2QkxidUVjbUduanp6ZlBRCklraFdrNFFEUW9sVXo1andWSlNzYlFaRGZpSE4rWW40ZHBBbkVZNzJxSS9SdnBKVVdLVzBJR2RBS1ZTdjdvVHIKSmVxZEY1RXNodnRTSzdXUndrSStuZ0g1dmdHbDhGVTlUcjVpSlFJREFRQUJBb0lCQUg5Qyt4UzhHbW02alB2YgpHR2FnVmp5bW1DTmkvT1pzb2tEZlFDb3huZno2R0g3SjlibDlWMHNIb3JvR3dkUUVXNGduQUxKV09seFFUbnJXClVodlduL043bDFqcW5HZnVtK3JxVHVNZC9HTjNMVUNzWVVqeTllbXcvMGRYTGRtRUk5OVJsbkhSVnpnSW9DNzYKemszSWxqSjdrUGcwZ1huR2U5dTJsc3lobmdaOUZUTnFXQVRvLy9PYzdBdTF2cG8wMTJpc0JzcTM2U2Q5Y0l3VApPUDUvUDdPRHBWSEhmbTlIelE5dGc0MldFSHJsTmc2ekpnem13Nm1pQzhsRGdHMzk0bmZtLzFxREZTZ0laVjA0ClhkcGZlMG5XQXNNTENBTFlOWUZ1RFZxY3JCSDBBTzhwK2VSQmp3Vk9wMk1XaENPY2hEK0xkRit1bkxoRVhZUDkKdXpWNXpRRUNnWUVBMTltZFdYYTZFb0thcXBQTU9qWDdpNXR6NGlpL0huUS9nVjcxUk5QN1NvbW8rVzRHT0ZMdgo1RERBRHU1Y2FUWDFONmU5Mlh4azNodGZ2dHJTVTFteit2NUtzcllYU3RVK0p6ZG5IQ1pPbUlkb0JMT1cvb1FMCkJFNDNYTHRQQlBNRFdUdkVaZWlJY2lxUWRrTzBsSlNLUVlRQ2tNNUhTTFZlWnlOSnAxc3A2T1VDZ1lFQTkxeHUKb3dWemEvenQ2Z3pLOUFRblJWSjNRNDlvVVhiVWdvejcwWEt0TGRFcWtrSll4M3VzRUJwelNGazF3bm1vaTU0Ngp6R1BBenM2cmMxUDdtSnY5UG1Ic3BIMjMyUTlWUmhHUWhiU3NCUzV6anIzNXpENis5RnRuUCtjUUlwWkY4MTRSCjgxUlJib1ExUW5OQWNqcG83bWs3YU5Uam9OTkVBZm05b3ZwTlFFRUNnWUVBamxXaHZPemRwbmNaSm9Kdm1iTWYKUE9BMWVsMEVLa0RkMzZHT2V1U09RSWltTkZTcEpWc0xkWjN3QitpR1o1cDlLVVlqbXRhOGJQb0FHUXFTeHdQUAoreUxVZnlRMEY5U21ONVlCR0Q3cWRRcFZQVVJ2dlVXMVBoR1YwRUJ6eXYrMHBaTVQzMStIR2tHWElXVmtIdFlVCmxUOUhzZFZVakUyTkF0WHlLN21oMlVFQ2dZQmhTTkllZlhOU29rd3p3OHBDUkN2cHdMQTFPdjZOSTQ0YXRqWUgKdnZGTFZydEdnSitIL1NURHhKTllmZlY5d2ZrK3lBRmFCMVY2UUovL29LVVA5VEdaU2t3V3VYY0lBRmJLVXZnagpEZGFseHdvZHRxdTYzMmFjbGlJNmFMYlkwMzg1WXVMdWIxZ0RmaTJ3TDhIRjZ5RC91eFZwZW1qNEJINzN3L0FJClhDYnJ3UUtCZ1FDbGl4aUdtcldESHExQ2ZLcWVPYnhVY0JkNEovTjZIV3FBNXRETDM4d3h4MHgva29ycEhqQ1oKQTZ5WG5yL0tkZlNKdHNINWFrYmRSd0t4bkkwV0NoYitzVEliYXpBekphdXR5R1QwRk5tekhiT0o1Yld4bVFybwp2S1kwcDB3Rk03SnYwcStQdlNJSlN6TWwvcE90akpkQ1hSb05sd2h5UDF3MnZhQVlxU1F4Nnc9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
EOF
mv config /root/.kube
